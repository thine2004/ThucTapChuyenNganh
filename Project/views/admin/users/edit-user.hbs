<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">{{title}}</h1>
    <a href="/admin/users?role={{user.role}}" class="btn btn-sm btn-secondary shadow-sm">
        <i class="fas fa-arrow-left fa-sm text-white-50"></i> Quay lại
    </a>
</div>

<div class="card shadow mb-4">
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary">Cập nhật thông tin</h6>
    </div>
    <div class="card-body">
        <form action="/admin/users/edit/{{user._id}}?_method=PUT" method="POST">
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="firstName">Tên (First Name) <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="firstName" name="firstName" value="{{user.firstName}}" required>
                </div>
                <div class="form-group col-md-6">
                    <label for="lastName">Họ (Last Name) <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="lastName" name="lastName" value="{{user.lastName}}" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group col-md-6">
                    <label for="email">Email</label>
                    <input type="email" class="form-control" id="email" value="{{user.email}}" readonly>
                    <small class="form-text text-muted">Email không thể thay đổi.</small>
                </div>
                <div class="form-group col-md-6">
                    <label for="role">Vai trò</label>
                     <select class="form-control" id="role" name="role">
                        <option value="user">Người dùng (User)</option>
                        <option value="admin">Quản trị viên (Admin)</option>
                    </select>
                </div>
            </div>


            <div class="form-group">
                <label for="isActive">Trạng thái</label>
                <select class="form-control" id="isActive" name="isActive">
                    <option value="true">Hoạt động</option>
                    <option value="false">Khóa</option>
                </select>
            </div>

            <hr>
            <h6 class="font-weight-bold text-primary mb-3">Đánh giá Năng lực (Proficiency Levels)</h6>
            <div class="alert alert-light border small">
                <i class="fa fa-info-circle"></i> Các mục đánh giá được lấy tự động từ các <b>Danh mục</b> có đánh dấu là <b>Luyện thi (isExam)</b>.
            </div>
            
            <div class="row">
                {{#each examCategories}}
                <div class="col-md-4 mb-3">
                    <label for="level_{{this.name}}">{{this.name}} (Max: {{this.maxScore}})</label>
                    <input type="number" step="0.1" class="form-control" 
                           id="level_{{this.name}}" 
                           name="levels[{{this.name}}]" 
                           value="{{getMapValue ../user.levels this.name}}" 
                           placeholder="Nhập điểm...">
                </div>
                {{/each}}
                
                {{#unless examCategories}}
                <div class="col-12">
                    <p class="text-muted italic">Chưa có danh mục thi nào được tạo. Hãy vào mục <a href="/admin/category">Danh mục</a> để thiết lập.</p>
                </div>
                {{/unless}}
            </div>

            <button type="submit" class="btn btn-primary">
                <i class="fa fa-save"></i> Cập nhật
            </button>
        </form>
    </div>
</div>

<script>
    // Set selected values
    document.getElementById('role').value = "{{user.role}}";
    document.getElementById('isActive').value = "{{user.isActive}}";
</script>
