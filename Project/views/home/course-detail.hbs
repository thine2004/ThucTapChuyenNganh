
<div class="container-xxl py-5">
    <div class="container">
        <div class="row g-5">
            <div class="col-lg-8 wow fadeInUp" data-wow-delay="0.1s">
                <div class="position-relative overflow-hidden mb-5">
                    <img class="img-fluid w-100" src="{{course.thumbnail}}" alt="{{course.title}}" style="border-radius: 5px;">
                    {{#if course.originalPrice}}
                    <div class="bg-danger text-white position-absolute top-0 end-0 m-3 py-1 px-2">
                        <small>GIẢM GIÁ</small>
                    </div>
                    {{/if}}
                </div>
                <h1 class="mb-4">{{course.title}}</h1>
                <div class="d-flex mb-3">
                    <small class="me-3"><i class="fa fa-user text-primary me-2"></i>{{course.instructor.name}}</small>
                    <small class="me-3"><i class="fa fa-clock text-primary me-2"></i>{{course.duration}} phút</small>
                    <small class="me-3"><i class="fa fa-star text-warning me-2"></i>{{course.averageRating}}</small>
                </div>
                <h3 class="mb-4 text-primary">{{course.price}}₫ 
                    {{#if course.originalPrice}}
                    <span class="text-muted fs-5"><del>{{course.originalPrice}}₫</del></span>
                    {{/if}}
                </h3>
                <p class="mb-4">{{course.description}}</p>
                
                <div class="d-flex align-items-center mb-4">
                    <form action="/cart/add/{{course._id}}" method="POST">
                        <button type="submit" class="btn btn-primary py-3 px-5"><i class="fa fa-shopping-cart me-2"></i>Đăng Ký Khóa Học Ngay</button>
                    </form>
                </div>

                <!-- Reviews Section -->
                <div class="mt-5">
                    <h4 class="mb-4">Học viên đánh giá</h4>
                    {{#each reviews}}
                    <div class="d-flex mb-4">
                        <img src="https://ui-avatars.com/api/?name={{this.user.firstName}}+{{this.user.lastName}}&background=random" class="img-fluid rounded-circle" style="width: 45px; height: 45px;">
                        <div class="ps-3">
                            <h6>{{this.user.firstName}} {{this.user.lastName}} <small class="text-muted ms-2">{{this.createdAt}}</small></h6>
                            <div class="text-primary mb-1">
                                {{!-- Logic for stars simplified --}}
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                            </div>
                            <p class="mb-0">{{this.comment}}</p>
                        </div>
                    </div>
                    {{else}}
                    <p class="text-muted">Chưa có đánh giá nào cho khóa học này.</p>
                    {{/each}}
                </div>

                <!-- Add Review Form -->
                <div class="bg-light p-4 mt-5">
                    <h4 class="mb-4">Gửi đánh giá của bạn</h4>
                    {{#if isLoggedIn}}
                    <form action="/reviews" method="POST">
                        <input type="hidden" name="courseId" value="{{course._id}}">
                        <input type="hidden" name="type" value="course">
                        <div class="row g-3">
                            <div class="col-12">
                                <label class="form-label">Xếp hạng của bạn</label>
                                <div class="text-primary fs-5 mb-2">
                                    <select name="rating" class="form-select w-auto" required>
                                        <option value="5">5 Sao - Tuyệt vời</option>
                                        <option value="4">4 Sao - Rất tốt</option>
                                        <option value="3">3 Sao - Bình thường</option>
                                        <option value="2">2 Sao - Kém</option>
                                        <option value="1">1 Sao - Rất tệ</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-12">
                                <textarea class="form-control" name="comment" rows="5" placeholder="Chia sẻ cảm nhận của bạn về khóa học này..." required></textarea>
                            </div>
                            <div class="col-12">
                                <button class="btn btn-primary py-3 px-5" type="submit">Gửi Đánh Giá</button>
                            </div>
                        </div>
                    </form>
                    {{else}}
                    <div class="text-center p-3">
                        <p>Vui lòng <a href="/login" class="text-primary">đăng nhập</a> để gửi đánh giá.</p>
                    </div>
                    {{/if}}
                </div>
            </div>

            <div class="col-lg-4 wow fadeInUp" data-wow-delay="0.3s">
                <div class="bg-light p-4 mb-5">
                    <h4 class="mb-4">Thông tin khóa học</h4>
                    <div class="d-flex justify-content-between mb-3">
                        <span>Giảng viên:</span>
                        <span class="text-secondary">{{course.instructor.name}}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-3">
                        <span>Thời lượng:</span>
                        <span class="text-secondary">{{course.duration}} phút</span>
                    </div>
                    <div class="d-flex justify-content-between mb-3">
                        <span>Trình độ:</span>
                        <span class="text-secondary">Tất cả</span>
                    </div>
                    <div class="d-flex justify-content-between mb-3">
                        <span>Ngôn ngữ:</span>
                        <span class="text-secondary">Tiếng Anh</span>
                    </div>
                     <div class="d-flex justify-content-between">
                        <span>Giá:</span>
                        <span class="text-primary fw-bold">{{course.price}}₫</span>
                    </div>
                </div>

                <div class="bg-light p-4 mb-5">
                    <h4 class="mb-4">Danh mục</h4>
                     <ul class="list-group list-group-flush">
                        {{#each categories}}
                        <li class="list-group-item bg-transparent border-bottom px-0">
                            <a href="/courses?category={{this._id}}" class="text-body d-block p-1">{{this.name}}</a>
                        </li>
                        {{/each}}
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
