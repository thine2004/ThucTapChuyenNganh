<div class="container-xxl py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card shadow-sm">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <h4 class="mb-0 text-white">{{test.title}}</h4>
                        <div id="timer" class="badge bg-danger fs-5">00:00</div>
                    </div>
                    <div class="card-body">
                         <div class="alert alert-info">
                            <i class="fa fa-info-circle me-2"></i> Thời gian làm bài: {{test.duration}} phút | Tổng số câu: {{test.questions.length}}
                        </div>

                        <form id="testForm" action="/tests/{{test._id}}/submit" method="POST">
                            {{#each test.questions}}
                            <div class="mb-4 p-3 border rounded">
                                <h6 class="mb-3">Câu {{addOne @index}}: {{this.content}}</h6>
                                {{!-- Logic hiển thị input dựa trên type câu hỏi, tạm thời hardcode multiple choice --}}
                                <div class="row">
                                    {{#each this.options}}
                                    <div class="col-md-6 mb-2">
                                        <div class="form-check">
                                            <input class="form-check-input" type="radio" name="answers[{{../_id}}]" id="q{{../_id}}_opt{{@index}}" value="{{this.text}}">
                                            <label class="form-check-label" for="q{{../_id}}_opt{{@index}}">
                                                {{this.text}}
                                            </label>
                                        </div>
                                    </div>
                                    {{/each}}
                                </div>
                            </div>
                            {{/each}}
                            
                            <div class="text-center mt-5">
                                <button type="submit" class="btn btn-primary btn-lg px-5">Nộp Bài Thi</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Timer Logic
    const durationMinutes = {{test.duration}};
    let timeRemaining = durationMinutes * 60;
    const timerDisplay = document.getElementById('timer');

    function updateTimer() {
        const minutes = Math.floor(timeRemaining / 60);
        const seconds = timeRemaining % 60;
        
        timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

        if (timeRemaining > 0) {
            timeRemaining--;
        } else {
            // Time is up
            clearInterval(timerInterval);
            alert('Hết giờ làm bài! Hệ thống sẽ tự động nộp bài.');
            document.getElementById('testForm').submit();
        }
    }

    const timerInterval = setInterval(updateTimer, 1000);
    updateTimer(); // Initial call
</script>
